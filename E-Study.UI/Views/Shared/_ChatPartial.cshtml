@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div class="position-fixed top-50 end-0" style="-webkit-transform: translateZ(0);">
    <div class="mt-3">
        <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScroll" aria-controls="offcanvasScroll">Assistant</button>
    </div>
</div>

<div class="offcanvas offcanvas-end" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScroll" aria-labelledby="offcanvasScrollLabel">
    <div class="offcanvas-header">
        <h5 id="offcanvasScrollLabel" class="offcanvas-title">Trợ lý ảo</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Đóng"></button>
    </div>

    <div class="offcanvas-body mx-0 flex-grow-0">
        <div class="chat-history-body ps ps--active-y">
            <ul class="list-unstyled chat-history mb-0">

                <div id="chatBox">
                </div>
            </ul>
        </div>
    </div>
    <div class="chat-history-footer position-absolute bottom-0 start-0 end-0">
        <input id="userMessage" type="text" class="form-control message-input border-0 me-3 shadow-none" placeholder="Type your message here...">
        <button class="btn btn-primary d-flex send-msg-btn" onclick="sendMessage()">
            <i class="bx bx-paper-plane me-md-1 me-0"></i>
            <span class="align-middle d-md-inline-block d-none">Send</span>
        </button>
    </div>
</div>

<script>
    function sendMessage() {
        var userMessage = document.getElementById("userMessage").value;

        // Send the user message to the server
        $.ajax({
            type: "POST",
            url: "/Course/GetChatResponse",
            data: { message: userMessage },
            success: function (response) {
                // Append the user's message to the chat box
                var userMessageElement = document.createElement("li");
                userMessageElement.textContent = "You: " + userMessage;
                document.getElementById("chatBox").appendChild(userMessageElement);

                // Append the chatbot's response to the chat box
                var chatbotResponseElement = document.createElement("li");
                chatbotResponseElement.textContent = "Chatbot: " + response;
                document.getElementById("chatBox").appendChild(chatbotResponseElement);

                // Scroll to the bottom of the chat box
                var chatHistoryBody = document.querySelector(".chat-history-body");
                chatHistoryBody.scrollTop = chatHistoryBody.scrollHeight;
            },
            error: function (xhr, status, error) {
                console.error("Error sending message:", error);
            }
        });
    }
</script>